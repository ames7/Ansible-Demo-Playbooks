---
  - name: Get instances info
    hosts: localhost
    connection: local
    gather_facts: no
    vars:
       aws_access_key: ''
       aws_secret_key: ''
       count: ''
       key_name: ''
       instance_type: ''
       image: ''
       wait: ''
       wait_timeout: ''
       assign_public_ip: ''
       subnet_name: ''


    tasks:
     - name: Checking if vpc_subnet_id defined if not looking up by Name
       ec2_vpc_subnet_info:
         filters:
           "tag:Name": "{{subnet_name}}"
       register: subnet_info
       debug:
         msg: "{{subnet_info}}"




     - name: Creating {{count}} AWS VMs in {{region}}
       ec2:
         key_name: "{{key_name}}"
         instance_type: "{{instance_type}}"
         image:  "{{image}}"
         wait: "{{wait}}"
         wait_timeout: "{{wait_timeout}}"
         group: "{{group}}"
         count: "{{count}}"
         vpc_subnet_id:  "{{vpc_subnet_id}}"
         assign_public_ip: "{{vpc_subnet_id}}""
