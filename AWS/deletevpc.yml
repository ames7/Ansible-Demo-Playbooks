---
  - name: Delete AWS VPC
    hosts: localhost
    connection: local
    gather_facts: no
    vars:
       aws_access_key: ''
       aws_secret_key: ''
       vpc_name: ''
       vpc_cidr: ''
       region: ''
       user_name: ''
       ec2_ansible_group: "{{user_name}}"
       ec2_security_group_name: "{{vpc_name}}_SECGRP"
       ec2_vpc_subnet_name: "{{vpc_name}}_Subnet"
       ec2_igw_name: "{{vpc_name}}_IGW"
       my_email_address: "{{user_name}}@redhat.com"
       deleteby: ''


    tasks:
     - name: Get VPC_ID for {{ec2_igw_name}} from {{ vpc_name }}_{{user_name}} in {{ region }}
       ec2_vpc_igw_info:
         region: "{{region}}"
         filters:
          "tag:Name": "{{ec2_igw_name}}"
       register: igw_info
     - name: Display igw_info
       debug:
         var: igw_info
     - name: Display igw_info
       debug:
         var: igw_info.internet_gateways


     - name: Remove VPC {{ vpc_name }}_{{user_name}} in {{ region }}
       ec2_vpc_net:
         name: "{{ vpc_name }}_{{user_name}}"
         cidr_block: "{{ vpc_cidr }}"
         region: "{{ region }}"
         state: absent
       tags:
         - removevpc
       register: my_vpc
