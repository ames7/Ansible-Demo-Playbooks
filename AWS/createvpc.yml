---
  - name: Create AWS VPC
    hosts: localhost
    connection: local
    gather_facts: no
    vars:
       aws_access_key: ''
       aws_secret_key: ''
       vpc_name: ''
       vpc_cidr: ''
       region: ''
       user_name: ''
       ec2_ansible_group: "{{user_name}}"
       my_email_address: "{{user_name}}@redhat.com"
       deleteby: ''

    tasks:
    - name: Create VPC {{ vpc_name }}_{{user_name}} in {{ region }}
      ec2_vpc_net:
        name: "{{ vpc_name }}_{{user_name}}"
        cidr_block: "{{ vpc_cidr }}"
        region: "{{ region }}"
        state: present

        tags:
          Name: "{{user_name}}"
          ansible_group: "{{ec2_ansible_group}}"
          Contact: "{{my_email_address}}"
          DeletebBy: "{{deleteby}}"
      register: my_vpc
    - name: Get vpc infor for "{{vpc_name}}"
      debug:
        var: my_vpc
      when: debug_flag is defined
    - include: createsecgroup.yml
