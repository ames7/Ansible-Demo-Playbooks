---
  - name: Create Azure Virtual Machine
    hosts: localhost
    connection: local
    gather_facts: no
    vars:
       az_rgname: ''
       az_vmname: ''
       az_vmusername: ''
       customer: ''
       AZURE_CLIENT_ID: ''
       AZURE_SECRET: ''
       AZURE_SUBSCRIPTION_ID: ''
       AZURE_TENANT: ''
    tasks:
       - include: createvmsecgroup.yml
#       - include: createpublicip.yml
       - name: Creating Vnic for {{az_vmname}}
         azure_rm_networkinterface:
           resource_group: "{{az_rgname}}"
           name: "{{az_vmname}}{{'_nic'}}"
           virtual_network: "{{az_rgname}}"
           subnet: "{{az_rgname}}{{'_net1'}}"
           public_ip_name: "{{az_vmname}}{{'_PublicIP'}}"
           security_group: "{{az_vmname}}{{'_SecGrp'}}"
           tags:
             created: ansbile
             delete: never
             demo: "{{customer}}"
             use: Demo
       - name: Creating Virtual Machine {{az_vmname}} in {{az_rgname}}_net1
         azure_rm_virtualmachine:
           resource_group: "{{az_rgname}}"
           name: "{{az_vmname}}"
           vm_size: Basic_A1
           admin_username: "{{az_username}}"
           ssh_password_enabled: false
           ssh_public_keys:
             - path: '/home/reddawg/.ssh/authorized_keys'
               key_data: ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAkO86PY4536QRXkOWeTbT+ljQG63lgoewETmsKJAJGPxsO7CeNcmdoFITjcWzH2FKdO/evpYEN4oHj+AhxHNhhk6naCc02Qa0lGNAzfa0aNsUatRrEIzVEsmqeGqPbC/zG6s3vi/vQY2L8YttG9c0Etzc2DXE29qF30XYCXtQwiDx5ANGe9apZT3XG8pEybxlbMRfs73qGSjWjL0Et7K+rl2RalBNI1zAwLGKH4tCKCogYytOcEfRNIAXaxHZNSre6n6hvOTmnnpiqHIIuo1afhgv6Glxa95dGUdNMq0+UAcrHRlyQUyNn4aiSnvWOU4nACzx/BlJTRxaGc7KI6Rkqw== REDDAWG-SSH-KEY
           network_interfaces: "{{az_vmname}}{{'_nic'}}"
           image:
             offer: rhel-byos
             publisher: RedHat
             sku: 'rhel-lvm77'
             version: latest
           plan:
             name: rhel-lvm77
             product: rhel-byos
             publisher: redhat
       - include: getpubip.yml
         vars:
           publicip: "{{az_vmname}}{{'_PublicIP'}}"
