---
  - name: Create Azure Virtual Machine
    hosts: localhost
    connection: local
    gather_facts: no
    vars:
       az_rgname: ''
       az_vmname: ''
       az_vmusername: ''
       customer: ''
       sshpubkey: !vault |
                  $ANSIBLE_VAULT;1.1;AES256
                  35616336393764376432303330633437643939313033616536626235656432666639613339346161
                  6531356131653635666532376637313465333866353434330a396136633430643066333365323661
                  38613964393462376261613637613261653237356636333732303238636565303835353437333135
                  3834333961656666640a343239666635346532346130386137666232373264663339626439623864
                  37393564393236306330616130386235353738376562643534323232653637366661366665643161
                  30316137613361353565373039393935666135626566386165623733626135326663303862613365
                  64323836643463633963313435346562643431373831613636316661333465316465353838383662
                  36363131643030326663386263373636366634383037653730333661316263376436356161353335
                  33623030633332646237653666373863393662383230613034633736616236396231393734666135
                  64616137323664306130643134613764633132336139643165353565626263633035643763353466
                  34343562323439626134383262616239616662626433666238383364303539343964383562336431
                  39386239616238313939633033373432336639323837306364363636616636393038356263316463
                  35393532333639616165626539366136666262373736643266366163663765353833623633333132
                  65356438633831393537386437313865366331616464653832613835373836613035333235383264
                  31653536393063643434623030626338333262666661393131373736633363363236646134626263
                  35393731393935373930613036353662653233663137656530306564323231323130386466656638
                  39326339613066633930643132626534393539396665396634383866636239373063313264343734
                  64653663663862653266656561376337303732383438623138343163626166343163356135616165
                  61363931383465313735333763333163646234346463646661323062353835633565373335626132
                  38623233376538363038663239356135643530613961323663646530346162383062313038353265
                  63343139393436663464346562626538633237623965323631366132316235366235373833373038
                  34323732633130633830663831323733326262303130613761636331306339386636656230376430
                  30653031313166646363653933323662643833343666613763663030626137346336306536323638
                  35366363393065353965
       AZURE_CLIENT_ID: ''
       AZURE_SECRET: ''
       AZURE_SUBSCRIPTION_ID: ''
       AZURE_TENANT: ''
    tasks:
       - name: Show SSHKEY
         debug:
           msg: "{{az_rgname}}"
       - include: createvmsecgroup.yml
#       - include: createpublicip.yml
       - name: Creating Vnic for {{az_vmname}}
         azure_rm_networkinterface:
           resource_group: "{{az_rgname}}"
           name: "{{az_vmname}}{{'_nic'}}"
           virtual_network: "{{az_rgname}}"
           subnet: "{{az_rgname}}{{'_net1'}}"
           ip_configurations:
             - name: "{{az_vmname}}{{'_int'}}"
               public_ip_address_name: "{{az_vmname}}{{'_PublicIP'}}"
               primary: yes
           security_group: "{{az_vmname}}{{'_SecGrp'}}"
           tags:
             created: ansbile
             delete: never
             demo: "{{customer}}"
             use: Demo
       - name: Creating Virtual Machine {{az_vmname}} in {{az_rgname}}_net1
         azure_rm_virtualmachine:
           resource_group: "{{az_rgname}}"
           name: "{{az_vmname}}"
           vm_size: Basic_A1
           admin_username: "{{az_vmusername}}"
           ssh_password_enabled: false
           ssh_public_keys:
             - path: "{{'/home/'}}{{az_vmusername}}{{'/.ssh/authorized_keys'}}"
               key_data: "{{sshpubkey}}"
           network_interfaces: "{{az_vmname}}{{'_nic'}}"
           image:
             offer: rhel-byos
             publisher: RedHat
             sku: 'rhel-lvm77'
             version: latest
           plan:
             name: rhel-lvm77
             product: rhel-byos
             publisher: redhat
       - include: getpubip.yml
         vars:
           publicip: "{{az_vmname}}{{'_PublicIP'}}"
